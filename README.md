# Lazy GitLab Runner Kubernetes Terraform Module

This module provides an easy way to deploy GitLab Runners on Kubernetes using Terraform. It is designed to replace the functionality of [terraform-kubernetes-gitlab-runner](https://github.com/MaciekLeks/terraform-kubernetes-gitlab-runner) while addressing some key limitations.

## Why a New Module?

GitLab has been systematically moving configuration attributes to TOML format. To accommodate this shift and provide a more flexible solution, this new module leverages the `Tobotimus/toml` provider. This allows for easier management of TOML configurations within Terraform.

## Why "Lazy"?

We call this module "lazy" because it uses a simple approach, unlike the more complex solutions in the old project. Here's why:

1. **Easy Setup**: We keep things consistent between Terraform and GitLab. For example, if GitLab uses camelCase, we use it in Terraform too. This:
   - Makes things simpler
   - Matches GitLab's own instructions better
   - Helps users switch between GitLab's docs and our module easily

2. **Straightforward Design**: What you put into Terraform is directly reflected in the GitLab Runner setup. This makes it easier to understand and fix if needed.

3. **Clear Structure**: I've removed unnecessary complications, making the module easier to understand and fix problems.

This "lazy" way focuses on keeping things simple and clear. It makes the module easier to use, especially for people who already know how to set up GitLab Runners.


## Key Features

- Simplified deployment of GitLab Runners on Kubernetes
- Utilizes the `Tobotimus/toml` provider for TOML encoding
- Designed to be more adaptable to GitLab's evolving configuration standards

## Getting Started
The first stable version of this module is now available (since v0.2.0)! You can find example configurations in the `samples` directory.

### Development Status

- [x] Core functionality implementation
- [x] Testing and validation
- [x] Documentation
- [x] Example configurations
- [x] First stable release

We appreciate your interest in this project. If you'd like to contribute or stay updated on its progress, please:

1. Star this repository to show your support
2. Watch this repository for updates
3. Check the Issues tab for current development tasks and known issues


## Contributing

Contributions are welcome! Just write an issue and create a pull request.

## Terraform Documentation
<!-- BEGIN_TF_DOCS -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.8.0 |
| <a name="requirement_helm"></a> [helm](#requirement\_helm) | >= 2.15.0 |
| <a name="requirement_kubernetes"></a> [kubernetes](#requirement\_kubernetes) | >= 2.23.0 |
| <a name="requirement_toml"></a> [toml](#requirement\_toml) | >= 0.3.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_helm"></a> [helm](#provider\_helm) | 2.15.0 |

## Modules

No modules.

## Resources

| Name | Type |
|------|------|
| [helm_release.gitlab_runner](https://registry.terraform.io/providers/hashicorp/helm/latest/docs/resources/release) | resource |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_affinity"></a> [affinity](#input\_affinity) | Affinity for runner pod assignment. | <pre>object({<br/>    nodeAffinity : optional(object({<br/>      preferredDuringSchedulingIgnoredDuringExecution : optional(list(object({<br/>        weight : number<br/>        preference : object({<br/>          matchExpressions : optional(list(object({<br/>            key : string<br/>            operator : string<br/>            values : list(string)<br/>          })))<br/>          matchFields : optional(list(object({<br/>            key : string<br/>            operator : string<br/>            values : list(string)<br/>          })))<br/>        })<br/>      })), null)<br/>      requiredDuringSchedulingIgnoredDuringExecution : optional(list(object({<br/>        nodeSelectorTerms : object({<br/>          matchExpressions : optional(object({<br/>            key : string<br/>            operator : string<br/>            values : list(string)<br/>          }))<br/>          matchFields : optional(object({<br/>            key : string<br/>            operator : string<br/>            values : list(string)<br/>          }))<br/>        })<br/>      })), null)<br/>    }), null)<br/><br/>    podAffinity : optional(object({<br/>      preferredDuringSchedulingIgnoredDuringExecution : optional(list(object({<br/>        podAffinityTerm : object({<br/>          weight : number<br/>          topology_key : string<br/>          namespaces : optional(list(string))<br/>          labelSelector : optional(object({<br/>            matchExpressions : optional(list(object({<br/>              key : string<br/>              operator : string<br/>              values : list(string)<br/>            })))<br/>            matchLabels : optional(list(string))<br/>          }))<br/>          namespaceSelector : optional(object({<br/>            matchExpressions : optional(list(object({<br/>              key : string<br/>              operator : string<br/>              values : list(string)<br/>            })))<br/>            matchLabels : optional(list(string))<br/>          }))<br/>        })<br/>      })), null)<br/>      requiredDuringSchedulingIgnoredDuringExecution : optional(list(object({<br/>        topology_key : string<br/>        namespaces : optional(list(string))<br/>        labelSelector : optional(object({<br/>          matchExpressions : optional(list(object({<br/>            key : string<br/>            operator : string<br/>            values : list(string)<br/>          })))<br/>          matchLabels : optional(list(string))<br/>        }))<br/>        namespaceSelector : optional(object({<br/>          matchExpressions : optional(list(object({<br/>            key : string<br/>            operator : string<br/>            values : list(string)<br/>          })))<br/>          matchLabels : optional(list(string))<br/>        }))<br/>      })), null)<br/>    }), null)<br/><br/>    podAntiAffinity : optional(object({<br/>      preferredDuringSchedulingIgnoredDuringExecution : optional(list(object({<br/>        podAffinityTerm : object({<br/>          weight : number<br/>          topology_key : string<br/>          namespaces : optional(list(string))<br/>          labelSelector : optional(object({<br/>            matchExpressions : optional(list(object({<br/>              key : string<br/>              operator : string<br/>              values : list(string)<br/>            })))<br/>            matchLabels : optional(list(string))<br/>          }))<br/>          namespaceSelector : optional(object({<br/>            matchExpressions : optional(list(object({<br/>              key : string<br/>              operator : string<br/>              values : list(string)<br/>            })))<br/>            matchLabels : optional(list(string))<br/>          }))<br/>        })<br/>      })), null)<br/>      requiredDuringSchedulingIgnoredDuringExecution : optional(list(object({<br/>        topology_key : string<br/>        namespaces : optional(list(string))<br/>        labelSelector : optional(object({<br/>          matchExpressions : optional(list(object({<br/>            key : string<br/>            operator : string<br/>            values : list(string)<br/>          })))<br/>          matchLabels : optional(list(string))<br/>        }))<br/>        namespaceSelector : optional(object({<br/>          matchExpressions : optional(list(object({<br/>            key : string<br/>            operator : string<br/>            values : list(string)<br/>          })))<br/>          matchLabels : optional(list(string))<br/>        }))<br/>      })), null)<br/>    }), null)<br/>  })</pre> | `{}` | no |
| <a name="input_automountServiceAccountToken"></a> [automountServiceAccountToken](#input\_automountServiceAccountToken) | Automount service account token in the deployment.. | `bool` | `false` | no |
| <a name="input_certSecretName"></a> [certSecretName](#input\_certSecretName) | Set the certsSecretName in order to pass custom certficates for GitLab Runner to use. | `string` | `null` | no |
| <a name="input_checkInterval"></a> [checkInterval](#input\_checkInterval) | Defines in seconds how often to check GitLab for a new builds. | `number` | `3` | no |
| <a name="input_concurrent"></a> [concurrent](#input\_concurrent) | Configure the maximum number of concurrent jobs | `number` | `10` | no |
| <a name="input_configMaps"></a> [configMaps](#input\_configMaps) | Additional ConfiMaps to be mounted. | `map(any)` | `null` | no |
| <a name="input_connectionMaxAge"></a> [connectionMaxAge](#input\_connectionMaxAge) | Configure GitLab Runner's maximum connection age for TLS keepalive connections. | `string` | `"15m0s"` | no |
| <a name="input_deploymentAnnotations"></a> [deploymentAnnotations](#input\_deploymentAnnotations) | Annotations to be added to the runner deployment. | `map(string)` | `{}` | no |
| <a name="input_deploymentLabels"></a> [deploymentLabels](#input\_deploymentLabels) | Labels to be added to the runner deployment. | `map(string)` | `{}` | no |
| <a name="input_deploymentLifecycle"></a> [deploymentLifecycle](#input\_deploymentLifecycle) | Configure the lifecycle of the runner deployment. | `map(any)` | `{}` | no |
| <a name="input_envVars"></a> [envVars](#input\_envVars) | Configure environment variables that will be present when the registration command runs. | <pre>list(object({<br/>    name : string<br/>    value : string<br/>  }))</pre> | `null` | no |
| <a name="input_extraEnv"></a> [extraEnv](#input\_extraEnv) | Extra environment variables to be added to the runner pods. | `map(string)` | `{}` | no |
| <a name="input_extraEnvFrom"></a> [extraEnvFrom](#input\_extraEnvFrom) | Additional environment variables from other data sources (k8s secrets). | <pre>map(object({<br/>    secretKeyRef : object({<br/>      name : string<br/>      key : string<br/>    })<br/>  }))</pre> | `{}` | no |
| <a name="input_extraObjects"></a> [extraObjects](#input\_extraObjects) | Additional k8s objects to be created. | `list(map(any))` | `[]` | no |
| <a name="input_gitlabUrl"></a> [gitlabUrl](#input\_gitlabUrl) | The GitLab Server URL (with protocol) that want to register the runner against. | `string` | n/a | yes |
| <a name="input_helm_settings"></a> [helm\_settings](#input\_helm\_settings) | The settings for the Helm chart. | <pre>object({<br/>    name             = optional(string, "gitlab-runner")<br/>    repository       = optional(string, "https://charts.gitlab.io")<br/>    chart            = optional(string, "gitlab-runner")<br/>    namespace        = optional(string, "gitlab-runner")<br/>    version          = optional(string, null) //default to last version<br/>    create_namespace = optional(bool, false)<br/>    atomic           = optional(bool, true)<br/>    wait             = optional(bool, true)<br/>    timeout          = optional(number, 300)<br/>  })</pre> | `{}` | no |
| <a name="input_hostAliases"></a> [hostAliases](#input\_hostAliases) | List of hosts and IPs that will be injected into the pod's hosts file. | <pre>list(object({<br/>    ip : string<br/>    hostnames : list(string)<br/>  }))</pre> | `[]` | no |
| <a name="input_hpa"></a> [hpa](#input\_hpa) | Horizontal Pod Autoscaling with API limited to metrics specification only (api/version: autoscaling/v2). | <pre>object({<br/>    minReplicas = number<br/>    maxReplicas = number<br/>    behavior = object({<br/>      scale_up = object({<br/>        stabilizationWindowSeconds = number<br/>        selectPolicy               = string<br/>        policies = list(object({<br/>          type          = string<br/>          value         = number<br/>          periodSeconds = number<br/>        }))<br/>      })<br/>      scaleDown = object({<br/>        stabilizationWindowSeconds = number<br/>        selectPolicy               = string<br/>        policies = list(object({<br/>          type           = string<br/>          value          = number<br/>          period_seconds = number<br/>        }))<br/>      })<br/>    })<br/>    metrics = list(object({<br/>      type = string<br/><br/>      resource = optional(object({<br/>        name = string<br/>        target = object({<br/>          type               = string<br/>          averageUtilization = optional(number)<br/>          averageValue       = optional(string)<br/>          value              = optional(string)<br/>        })<br/>      }))<br/>      pods = optional(object({<br/>        metric = object({<br/>          name = string<br/>          selector = optional(object({<br/>            matchLabels = optional(map(string))<br/>          }))<br/>        })<br/>        target = object({<br/>          type         = string<br/>          averageValue = optional(string)<br/>          value        = optional(string)<br/>        })<br/>      }))<br/>      object = optional(object({<br/>        metric = object({<br/>          name = string<br/>          selector = optional(object({<br/>            matchLabels = optional(map(string))<br/>          }))<br/>        })<br/>        describedObject = object({<br/>          apiVersion = string<br/>          kind       = string<br/>          name       = string<br/>        })<br/>        target = object({<br/>          type         = string<br/>          averageValue = optional(string)<br/>          value        = optional(string)<br/>        })<br/>      }))<br/>      external = optional(object({<br/>        metric = object({<br/>          name = string<br/>          selector = optional(object({<br/>            matchLabels = optional(map(string))<br/>          }))<br/>        })<br/>        target = optional(object({<br/>          type         = string<br/>          averageValue = optional(string)<br/>          value        = optional(string)<br/>        }))<br/>      }))<br/>      containerResource = optional(object({<br/>        name      = string<br/>        container = string<br/>        target = object({<br/>          type               = string<br/>          averageUtilization = optional(number)<br/>          averageValue       = optional(string)<br/>          value              = optional(string)<br/>        })<br/>      }))<br/>    }))<br/>  })</pre> | `null` | no |
| <a name="input_image"></a> [image](#input\_image) | The docker gitlab runner image. | <pre>object({<br/>    registry : optional(string, "registry.gitlab.com")<br/>    image : optional(string, "gitlab-org/gitlab-runner")<br/>    tag : optional(string)<br/>  })</pre> | `{}` | no |
| <a name="input_imagePullPolicy"></a> [imagePullPolicy](#input\_imagePullPolicy) | Specify the job images pull policy: Never, IfNotPresent, Always. | `string` | `"IfNotPresent"` | no |
| <a name="input_imagePullSecrets"></a> [imagePullSecrets](#input\_imagePullSecrets) | A array of secrets that are used to authenticate Docker image pulling. | <pre>list(object({<br/>    name = string<br/>  }))</pre> | `null` | no |
| <a name="input_livenessProbe"></a> [livenessProbe](#input\_livenessProbe) | n/a | <pre>object({<br/>    initialDelaySeconds           = optional(number, 60)<br/>    periodSeconds                 = optional(number, 10)<br/>    successThreshold              = optional(number, 1)<br/>    failureThreshold              = optional(number, 3)<br/>    terminationGracePeriodSeconds = optional(number, 30)<br/>  })</pre> | `{}` | no |
| <a name="input_logFormat"></a> [logFormat](#input\_logFormat) | Specifies the log format. Options are runner, text, and json. This setting has lower priority than the format set by command-line argument --log-format. The default value is runner, which contains ANSI escape codes for coloring. | `string` | `"runner"` | no |
| <a name="input_logLevel"></a> [logLevel](#input\_logLevel) | Configure GitLab Runner's logging level. Available values are: debug, info, warn, error, fatal, panic. | `string` | `"info"` | no |
| <a name="input_metrics"></a> [metrics](#input\_metrics) | Configure integrated Prometheus metrics exporter. | <pre>object({<br/>    enabled : optional(bool, false)<br/>    portName : optional(string, "metrics")<br/>    port : optional(number, 9252)<br/>    serviceMonitor : optional(object({<br/>      enabled : optional(bool, false)<br/>      labels : optional(map(string), {})<br/>      annotations : optional(map(string), {})<br/>      interval : optional(string, "1m")<br/>      scheme : optional(string, "http")<br/>      tlsConfig : optional(map(string), {})<br/>      path : optional(string, "/metrics")<br/>      metricRelabeling : optional(list(string), [])<br/>      relabelings : optional(list(string), [])<br/>    }), {})<br/>  })</pre> | `{}` | no |
| <a name="input_nodeSelector"></a> [nodeSelector](#input\_nodeSelector) | A map of node selectors to apply to the pods | `map(string)` | `{}` | no |
| <a name="input_podAnnotations"></a> [podAnnotations](#input\_podAnnotations) | Annotations to be added to the runner pods. | `map(string)` | `{}` | no |
| <a name="input_podLabels"></a> [podLabels](#input\_podLabels) | Labels to be added to the runner pods. | `map(string)` | `{}` | no |
| <a name="input_podSecurityContext"></a> [podSecurityContext](#input\_podSecurityContext) | Runner ecurity context for the whole POD. | <pre>object({<br/>    runAsUser : optional(number, 100)<br/>    runAsGroup : optional(number, 65533)<br/>    fsGroup : optional(number, 65533)<br/>    supplementalGroups : optional(list(number), [65533])<br/>  })</pre> | `{}` | no |
| <a name="input_preEntryScript"></a> [preEntryScript](#input\_preEntryScript) | A custom bash script that will be executed prior to the invocation of the gitlab-runner process | `string` | `null` | no |
| <a name="input_priorityClassName"></a> [priorityClassName](#input\_priorityClassName) | Configure priorityClassName for the runner pod. If not set, globalDefault priority class is used. | `string` | `""` | no |
| <a name="input_rbac"></a> [rbac](#input\_rbac) | RBAC support. | <pre>object({<br/>    create : optional(bool, false) #create k8s SA and apply RBAC roles #depreciated<br/><br/>    rules : optional(list(object({           # Define list of rules to be added to the rbac role permissions.<br/>      resources : optional(list(string), []) #resources : optional(list(string), ["pods", "pods/exec", "pods/attach", "secrets", "configmaps"])<br/>      apiGroups : optional(list(string), [""])<br/>      verbs : optional(list(string)) #verbs : optional(list(string), ["get", "list", "watch", "create", "patch", "delete"])<br/>    })), [])<br/><br/>    clusterWideAccess : optional(bool, false)<br/><br/>    podSecurityPolicy : optional(object({<br/>      enabled : optional(bool, false)<br/>      resourceNames : optional(list(string), [])<br/>    }), {})<br/>  })</pre> | `{}` | no |
| <a name="input_readinessProbe"></a> [readinessProbe](#input\_readinessProbe) | n/a | <pre>object({<br/>    initialDelaySeconds = optional(number, 60)<br/>    periodSeconds       = optional(number, 10)<br/>    successThreshold    = optional(number, 1)<br/>    failureThreshold    = optional(number, 3)<br/>  })</pre> | `{}` | no |
| <a name="input_replicas"></a> [replicas](#input\_replicas) | The number of runner pods to create. | `number` | `1` | no |
| <a name="input_resources"></a> [resources](#input\_resources) | The CPU and memory resources given to the runner. | <pre>object({<br/>    requests = optional(object({<br/>      cpu               = optional(string)<br/>      memory            = optional(string)<br/>      ephemeral-storage = optional(string)<br/>    })),<br/>    limits = optional(object({<br/>      cpu               = optional(string)<br/>      memory            = optional(string)<br/>      ephemeral-storage = optional(string)<br/>    }))<br/>  })</pre> | `null` | no |
| <a name="input_runnerToken"></a> [runnerToken](#input\_runnerToken) | The Runner Token for adding new Runners to the GitLab Server. | `string` | n/a | yes |
| <a name="input_runners"></a> [runners](#input\_runners) | n/a | <pre>object({<br/>    name       = string<br/>    configPath = optional(string, "")      // "Absolute path for an existing runner configuration file"<br/>    secret     = optional(string, null)    // "Secret name containing the runner registration token"<br/>    cache      = optional(map(string), {}) //Distributed cache secret<br/>    config = list(object({<br/>      executor = optional(string, "kubernetes")<br/>      shell    = optional(string, "bash")<br/><br/>      environment = optional(list(string), null)<br/>      cache_dir   = optional(string)<br/><br/>      unhealthy_requests_limit = optional(number, 30)     //The number of unhealthy responses to new job requests after which a runner worker will be disabled.<br/>      unhealthy_interval       = optional(string, "120s") //Duration that a runner worker is disabled for after it exceeds the unhealthy requests limit. <br/>      output_limit             = optional(number, 4096)   //Maximum build log size in kilobytes. Default is 4096 (4MB).<br/><br/><br/>      kubernetes = object({<br/>        namespace                    = string<br/>        pod_labels                   = optional(map(string), null) // job's pods labels<br/>        pod_labels_overwrite_allowed = optional(string, null)      //Regular expression to validate the contents of the pod labels overwrite environment variable. When empty, it disables the pod labels overwrite feature.<br/>        pod_annotations              = optional(map(string), null) // job's annotations<br/><br/>        poll_interval : optional(number, 3)  //How frequently, in seconds, the runner will poll the Kubernetes pod it has just created to check its status<br/>        poll_timeout : optional(number, 180) //The amount of time, in seconds, that needs to pass before the runner will time out attempting to connect to the container it has just created. <br/><br/>        image                            = optional(string) //The image to run jobs with.<br/>        helper_image                     = optional(string) //The default helper image used to clone repositories and upload artifacts.<br/>        helper_image_flavor              = optional(string) //Sets the helper image flavor (alpine, alpine3.16, alpine3.17, alpine3.18, alpine3.19, alpine-latest, ubi-fips or ubuntu). Defaults to alpine. The alpine flavor uses the same version as alpine3.19.<br/>        helper_image_autoset_arch_and_os = optional(string) //Uses the underlying OS to set the Helper Image ARCH and OS.<br/><br/>        image_pull_secrets = optional(list(string), null)       // An array of items containing the Kubernetes docker-registry secret names used to authenticate Docker image pulling from private registries.<br/>        pull_policy        = optional(string, "if-not-present") //The Kubernetes pull policy for the runner container. Defaults to if-not-present.<br/>        privileged         = optional(bool, false)              //Whether to run job's podss containers in privileged mode. Defaults to false.<br/><br/>        // cpu requests and limits<br/>        cpu_limit : optional(string)<br/>        cpu_limit_overwrite_max_allowed : optional(string)<br/>        cpu_request : optional(string)<br/>        cpu_request_overwrite_max_allowed : optional(string)<br/>        memory_limit : optional(string)<br/>        memory_limit_overwrite_max_allowed : optional(string)<br/>        memory_request : optional(string)<br/>        memory_request_overwrite_max_allowed : optional(string)<br/>        ephemeral_storage_limit : optional(string)<br/>        ephemeral_storage_limit_overwrite_max_allowed : optional(string)<br/>        ephemeral_storage_request : optional(string)<br/>        ephemeral_storage_request_overwrite_max_allowed : optional(string)<br/><br/>        //helper containers<br/>        helper_cpu_limit : optional(string)<br/>        helper_cpu_limit_overwrite_max_allowed : optional(string)<br/>        helper_cpu_request : optional(string)<br/>        helper_cpu_request_overwrite_max_allowed : optional(string)<br/>        helper_memory_limit : optional(string)<br/>        helper_memory_limit_overwrite_max_allowed : optional(string)<br/>        helper_memory_request : optional(string)<br/>        helper_memory_request_overwrite_max_allowed : optional(string)<br/>        helper_ephemeral_storage_limit : optional(string)<br/>        helper_ephemeral_storage_limit_overwrite_max_allowed : optional(string)<br/>        helper_ephemeral_storage_request : optional(string)<br/>        helper_ephemeral_storage_request_overwrite_max_allowed : optional(string)<br/><br/>        // service containers<br/>        service_cpu_limit : optional(string)<br/>        service_cpu_limit_overwrite_max_allowed : optional(string)<br/>        service_cpu_request : optional(string)<br/>        service_cpu_request_overwrite_max_allowed : optional(string)<br/>        service_memory_limit : optional(string)<br/>        service_memory_limit_overwrite_max_allowed : optional(string)<br/>        service_memory_request : optional(string)<br/>        service_memory_request_overwrite_max_allowed : optional(string)<br/>        service_ephemeral_storage_limit : optional(string)<br/>        service_ephemeral_storage_limit_overwrite_max_allowed : optional(string)<br/>        service_ephemeral_storage_request : optional(string)<br/>        service_ephemeral_storage_request_overwrite_max_allowed : optional(string)<br/><br/>        pod_security_context = optional(object({<br/>          fs_group : optional(number)<br/>          run_as_group : optional(number)<br/>          run_as_non_root : optional(bool)<br/>          run_as_user : optional(number)<br/>          supplemental_groups : optional(list(number))<br/>          selinux_options : optional(string)<br/>        }), null)<br/><br/>        node_selector    = optional(map(string), null) //Job PODs node selector<br/>        node_tolerations = optional(map(string), null) //Job PODs node tolerations<br/><br/>        volumes = optional(object({<br/>          empty_dir = optional(list(object({<br/>            name       = string<br/>            mount_path = string<br/>            medium     = optional(string, null)<br/>            size_limit = optional(string, null)<br/>          })), null)<br/>          host_path = optional(list(object({<br/>            name       = string<br/>            mount_path = string<br/>            host_path  = string<br/>            read_only  = optional(bool, false)<br/>          })), null)<br/>          pvc = optional(list(object({<br/>            name       = string<br/>            mount_path = string<br/>            read_only  = optional(bool, false)<br/>          })), null)<br/>          config_map = optional(list(object({<br/>            name       = string<br/>            mount_path = string<br/>            read_only  = optional(bool, false)<br/>            items      = optional(map(string), null)<br/>          })), null)<br/>          secret = optional(list(object({<br/>            name       = string<br/>            mount_path = string<br/>            read_only  = optional(bool, false)<br/>            items      = optional(map(string), null)<br/>          })), null)<br/>          csi = optional(list(object({<br/>            name              = string<br/>            mount_path        = string<br/>            read_only         = optional(bool, false)<br/>            driver            = string<br/>            volume_attributes = optional(map(string), null)<br/>          })), null)<br/>        }), null)<br/><br/>        service_account                   = optional(string, null) //Default service account job/executor pods use to talk to Kubernetes API. If not set, the default service account is used.<br/>        service_account_overwrite_allowed = optional(string, null) //Regular expression to validate the contents of the service account overwrite environment variable. When empty, it disables the service account overwrite feature.<br/><br/>        affinity = optional(object({<br/>          node_affinity : optional(object({<br/>            preferred_during_scheduling_ignored_during_execution : optional(list(object({<br/>              weight : number<br/>              preference : object({<br/>                match_expressions : optional(list(object({<br/>                  key : string<br/>                  operator : string<br/>                  values : list(string)<br/>                })))<br/>                match_fields : optional(list(object({<br/>                  key : string<br/>                  operator : string<br/>                  values : list(string)<br/>                })))<br/>              })<br/>            })), null)<br/>            required_during_scheduling_ignored_during_execution : optional(list(object({<br/>              node_selector_terms : object({<br/>                match_expressions : optional(object({<br/>                  key : string<br/>                  operator : string<br/>                  values : list(string)<br/>                }))<br/>                match_fields : optional(object({<br/>                  key : string<br/>                  operator : string<br/>                  values : list(string)<br/>                }))<br/>              })<br/>            })), null)<br/>          }), null)<br/><br/>          pod_affinity : optional(object({<br/>            preferred_during_scheduling_ignored_during_execution : optional(list(object({<br/>              pod_affinity_term : object({<br/>                weight : number<br/>                topology_key : string<br/>                namespaces : optional(list(string))<br/>                label_selector : optional(object({<br/>                  match_expressions : optional(list(object({<br/>                    key : string<br/>                    operator : string<br/>                    values : list(string)<br/>                  })))<br/>                  match_labels : optional(list(string))<br/>                }))<br/>                namespace_selector : optional(object({<br/>                  match_expressions : optional(list(object({<br/>                    key : string<br/>                    operator : string<br/>                    values : list(string)<br/>                  })))<br/>                  match_labels : optional(list(string))<br/>                }))<br/>              })<br/>            })), null)<br/>            required_during_scheduling_ignored_during_execution : optional(list(object({<br/>              topology_key : string<br/>              namespaces : optional(list(string))<br/>              label_selector : optional(object({<br/>                match_expressions : optional(list(object({<br/>                  key : string<br/>                  operator : string<br/>                  values : list(string)<br/>                })))<br/>                match_labels : optional(list(string))<br/>              }))<br/>              namespace_selector : optional(object({<br/>                match_expressions : optional(list(object({<br/>                  key : string<br/>                  operator : string<br/>                  values : list(string)<br/>                })))<br/>                match_labels : optional(list(string))<br/>              }))<br/>            })), null)<br/>          }), null)<br/><br/>          pod_anti_affinity : optional(object({<br/>            preferred_during_scheduling_ignored_during_execution : optional(list(object({<br/>              pod_affinity_term : object({<br/>                weight : number<br/>                topology_key : string<br/>                namespaces : optional(list(string))<br/>                label_selector : optional(object({<br/>                  match_expressions : optional(list(object({<br/>                    key : string<br/>                    operator : string<br/>                    values : list(string)<br/>                  })))<br/>                  match_labels : optional(list(string))<br/>                }))<br/>                namespace_selector : optional(object({<br/>                  match_expressions : optional(list(object({<br/>                    key : string<br/>                    operator : string<br/>                    values : list(string)<br/>                  })))<br/>                  match_labels : optional(list(string))<br/>                }))<br/>              })<br/>            })), null)<br/>            required_during_scheduling_ignored_during_execution : optional(list(object({<br/>              topology_key : string<br/>              namespaces : optional(list(string))<br/>              label_selector : optional(object({<br/>                match_expressions : optional(list(object({<br/>                  key : string<br/>                  operator : string<br/>                  values : list(string)<br/>                })))<br/>                match_labels : optional(list(string))<br/>              }))<br/>              namespace_selector : optional(object({<br/>                match_expressions : optional(list(object({<br/>                  key : string<br/>                  operator : string<br/>                  values : list(string)<br/>                })))<br/>                match_labels : optional(list(string))<br/>              }))<br/>            })), null)<br/>          }), null)<br/>        }), null) //affinity<br/>      })          //kubernetes<br/><br/>      // start of cache block<br/>      cache = optional(object({<br/>        Type                   = optional(string, "gcs")<br/>        Path                   = optional(string, "")<br/>        Shared                 = optional(bool)<br/>        MaxUploadedArchiveSize = optional(number)<br/>        gcs = optional(object({<br/>          CredentialsFile : optional(string)<br/>          AccessId : optional(string)<br/>          PrivateKey : optional(string)<br/>          BucketName : string<br/>        }), null)<br/>        s3          = optional(map(any), null) //TODO: add static typing as for gcs<br/>        azure       = optional(map(any), null) //TODO: add static typing as for gcs<br/>        secret_name = optional(string)<br/>      }), null)<br/>      // end of cache block<br/>  })) })</pre> | n/a | yes |
| <a name="input_schedulerName"></a> [schedulerName](#input\_schedulerName) | The name of the scheduler to use. | `string` | `null` | no |
| <a name="input_secrets"></a> [secrets](#input\_secrets) | Secrets to be additionally mounted to the containers. | <pre>list(object({<br/>    name = string<br/>    items = optional(list(object({<br/>      key  = string<br/>      path = string<br/>    })))<br/>  }))</pre> | `[]` | no |
| <a name="input_securityContext"></a> [securityContext](#input\_securityContext) | Runner container security context. | <pre>object({<br/>    allowPrivilegeEscalation : optional(bool, false)<br/>    readOnlyRootFilesystem : optional(bool, false)<br/>    runAsNonRoot : optional(bool, true)<br/>    privileged : optional(bool, false)<br/>    capabilities : optional(object({<br/>      add : optional(list(string), [])<br/>      drop : optional(list(string), [])<br/>    }), { drop : ["ALL"] })<br/>  })</pre> | `{}` | no |
| <a name="input_sentryDsn"></a> [sentryDsn](#input\_sentryDsn) | Configure GitLab Runner's Sentry DSN. | `string` | `null` | no |
| <a name="input_service"></a> [service](#input\_service) | Configure a service resource e.g., to allow scraping metrics via prometheus-operator serviceMonitor. | <pre>object({<br/>    enabled : optional(bool, false)<br/>    labels : optional(map(string), {})<br/>    annotations : optional(map(string), {})<br/>    clusterIP : optional(string, "")<br/>    externalIPs : optional(list(string), [])<br/>    loadBalancerIP : optional(string, "")<br/>    loadBalancerSourceRanges : optional(list(string), [])<br/>    type : optional(string, "ClusterIP")<br/>    metrics : optional(object({<br/>      nodePort : optional(string, "")<br/>    }), null),<br/>    additionalPorts : optional(list(string), [])<br/>  })</pre> | `{}` | no |
| <a name="input_serviceAccount"></a> [serviceAccount](#input\_serviceAccount) | The name of the k8s service account to create (since 17.x.x) | <pre>object({<br/>    create           = optional(bool, false)<br/>    name             = optional(string, "")<br/>    annotations      = optional(map(string), {})<br/>    imagePullSecrets = optional(list(string), [])<br/>  })</pre> | `{}` | no |
| <a name="input_sessionServer"></a> [sessionServer](#input\_sessionServer) | Configuration for the session server | <pre>object({<br/>    enabled                  = optional(bool, false)<br/>    annotations              = optional(map(string), null)<br/>    timeout                  = optional(number, null)<br/>    internalPort             = optional(number, null)<br/>    externalPort             = optional(number, null)<br/>    nodePort                 = optional(number, null)<br/>    publicIP                 = optional(string, null)<br/>    loadBalancerSourceRanges = optional(list(string), null)<br/>    serviceType              = optional(string, null)<br/>  })</pre> | `{}` | no |
| <a name="input_shutdown_timeout"></a> [shutdown\_timeout](#input\_shutdown\_timeout) | Number of seconds until the forceful shutdown operation times out and exits the process. The default value is 30. If set to 0 or lower, the default value is used. | `number` | `0` | no |
| <a name="input_strategy"></a> [strategy](#input\_strategy) | Configure update strategy for multi-replica deployments | <pre>object({<br/>    type = string<br/>    rollingUpdate = optional(object({<br/>      maxSurge       = string<br/>      maxUnavailable = string<br/>    }), null)<br/>  })</pre> | `null` | no |
| <a name="input_terminationGracePeriodSeconds"></a> [terminationGracePeriodSeconds](#input\_terminationGracePeriodSeconds) | When stopping the runner, give it time (in seconds) to wait for its jobs to terminate. | `number` | `3600` | no |
| <a name="input_tolerations"></a> [tolerations](#input\_tolerations) | List of node taints to tolerate by the runner PODs. | <pre>list(object({<br/>    key : string<br/>    operator : string<br/>    value : string<br/>    effect : string<br/>  }))</pre> | `[]` | no |
| <a name="input_topologySpreadConstraints"></a> [topologySpreadConstraints](#input\_topologySpreadConstraints) | TopologySpreadConstraints for pod assignment. | <pre>list(object({<br/>    maxSkew : number<br/>    minDomain : optional(number, 1)<br/>    topologyKey : string<br/>    whenUnsatisfiable : string<br/>    labelSelector : object({<br/>      matchLabels : optional(map(string), {})<br/>      matchExpressions : optional(list(object({<br/>        key : string<br/>        operator : string<br/>        values : list(string)<br/>      })), [])<br/>    })<br/>    matchLabelKeys : optional(list(string), null)<br/>    nodeAffinityPolicy : optional(string, null)<br/>    nodeTaintsPolicy : optional(string, null)<br/>  }))</pre> | `null` | no |
| <a name="input_unregisterRunners"></a> [unregisterRunners](#input\_unregisterRunners) | Unregister runners before termination. | `bool` | `true` | no |
| <a name="input_useTiny"></a> [useTiny](#input\_useTiny) | Use the tiny runner image | `bool` | `false` | no |
| <a name="input_values"></a> [values](#input\_values) | Additional values to be passed to the gitlab-runner helm chart | `map(any)` | `{}` | no |
| <a name="input_values_file"></a> [values\_file](#input\_values\_file) | Path to Values file to be passed to gitlab-runner helm chart | `string` | `null` | no |
| <a name="input_volumeMounts"></a> [volumeMounts](#input\_volumeMounts) | Additional volumeMounts to add to the runner container. | <pre>list(object({<br/>    mountPath : string<br/>    name : string<br/>    mountPropagation : optional(string)<br/>    readOnly : optional(bool, false)<br/>    subPath : optional(string)<br/>    subPathExpr : optional(string)<br/>  }))</pre> | `[]` | no |
| <a name="input_volumes"></a> [volumes](#input\_volumes) | List of volumes to be attached to the pod | <pre>list(object({<br/>    name      = string<br/>    type      = string<br/>    options   = map(string)<br/>    localPath = optional(string)<br/>    hostPath = optional(object({<br/>      path = string<br/>      type = optional(string)<br/>    }))<br/>    configMap = optional(object({<br/>      name = string<br/>      items = optional(list(object({<br/>        key  = string<br/>        path = string<br/>      })))<br/>    }))<br/>    secret = optional(object({<br/>      secretName = string<br/>      items = optional(list(object({<br/>        key  = string<br/>        path = string<br/>      })))<br/>    }))<br/>    emptyDir = optional(object({<br/>      medium    = optional(string)<br/>      sizeLimit = optional(string)<br/>    }))<br/>  }))</pre> | `[]` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_helm_release"></a> [helm\_release](#output\_helm\_release) | n/a |
| <a name="output_helm_values"></a> [helm\_values](#output\_helm\_values) | n/a |
| <a name="output_runners"></a> [runners](#output\_runners) | n/a |
<!-- END_TF_DOCS -->

## License

This project is free to use and distribute under the MIT License. See [LICENSE](https://mit-license.org) for more information.



